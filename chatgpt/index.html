<!DOCTYPE html>
<html>
<head>
    <title>ChatGPT Â· æç®€å¢å¼ºç‰ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="icon.png" type="image/png">
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fff;
            color: #000;
            padding-top: 64px;
            padding-bottom: 140px;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 12px 15px;
            background: #fff;
            display: flex;
            align-items: center;
            z-index: 1000;
        }
        .new-chat-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            margin-right: 15px;
            position: relative;
        }
        .new-chat-btn:hover {
            background: #e5e5e5;
        }
        .new-chat-btn:hover::after {
            content: 'æ–°èŠå¤©';
            position: absolute;
            bottom: -38px;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            z-index: 1001;
        }
        .custom-select {
            position: relative;
            width: 250px;
        }
        .select-selected {
            padding: 10px 12px;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            background: #fff;
            font-size: 14px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .select-selected::after {
            content: "â–¼";
            font-size: 10px;
            color: #666;
            transition: transform 0.2s;
        }
        .select-items {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
        }
        .select-items.active {
            display: block;
        }
        .select-item {
            padding: 10px 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .select-item:hover {
            background: #f5f5f5;
        }
        .select-item.selected {
            background: #e3f2fd;
            font-weight: 500;
        }
        .chat-container {
            height: calc(100vh - 204px);
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        .message {
            margin-bottom: 16px;
            padding: 16px;
            background: #f5f5f5;
            border-radius: 10px;
            max-width: 85%;
        }
        .message.user {
            align-self: flex-end;
            background: #e0e0e0;
        }
        .message.ai {
            align-self: flex-start;
        }
        .model-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }
        .message-content {
            font-size: 16px;
            line-height: 1.5;
        }
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #000;
            font-size: 28px;
            margin: auto;
        }
        .bottom-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: #fff;
            z-index: 1000;
        }
        .web-search-toggle {
            border: 1px solid #d0d0d0;
            border-radius: 18px;
            background: #fff;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            height: 36px;
            margin-bottom: 8px;
        }
        .web-search-toggle.active {
            background: #e3f2fd;
            color: #1565c0;
            border-color: #1565c0;
        }
        /* å¢å¼ºæŒ‰é’®å®¹å™¨ */
        .enhancements-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
            min-height: 36px;
        }
        .enhancement-btn {
            border: 1px solid #d0d0d0;
            border-radius: 18px;
            background: #fff;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            height: 36px;
            transition: all 0.2s;
        }
        .enhancement-btn.active {
            background: #e3f2fd;
            color: #1565c0;
            border-color: #1565c0;
        }
        .enhancement-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .input-container {
            display: flex;
            align-items: flex-start;
            position: relative;
        }
        .input-box {
            flex: 1;
            min-height: 48px;
            max-height: 132px;
            padding: 10px 50px 10px 15px;
            border: 1px solid #d0d0d0;
            border-radius: 24px;
            resize: none;
            font-size: 16px;
            font-family: inherit;
            overflow-y: auto;
            background: #fff;
            color: #000;
            line-height: 1.4;
        }
        .input-box:focus { outline: none; border-color: #888; }
        .send-button {
            position: absolute;
            right: 10px;
            bottom: 8px;
            border: none;
            border-radius: 50%;
            background: #000;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        .send-button:disabled { background: #ccc; cursor: not-allowed; }
        .send-button svg {
            fill: white;
            width: 18px;
            height: 18px;
        }
        .footer {
            text-align: center;
            padding: 12px 15px 0;
            font-size: 12px;
            color: #666;
        }
        .typing {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #888;
            border-radius: 50%;
            margin-right: 4px;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="new-chat-btn" id="newChatBtn">
            <img src="icon.png" width="20" height="20">
        </button>
        <div class="custom-select" id="customSelect">
            <div class="select-selected" id="selectSelected">GPT-5.2 Instant</div>
            <div class="select-items" id="selectItems"></div>
        </div>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="welcome-message" id="welcomeMessage"></div>
    </div>
    
    <div class="bottom-section">
        <button class="web-search-toggle" id="webSearchToggle">ğŸŒ è”ç½‘æœç´¢</button>
        <!-- åŠ¨æ€å¢å¼ºæŒ‰é’®å®¹å™¨ (åˆå§‹éšè—) -->
        <div class="enhancements-container" id="enhancementsContainer" style="display: none;"></div>
        
        <div class="input-container">
            <textarea class="input-box" id="inputBox" placeholder="æœ‰é—®é¢˜ï¼Œå°½ç®¡é—®" rows="2"></textarea>
            <button class="send-button" id="sendButton">
                <svg viewBox="0 0 24 24" width="18" height="18">
                    <path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.58L20 12l-8-8-8 8z"></path>
                </svg>
            </button>
        </div>
        <div class="footer">
            å‘ AI èŠå¤©æœºå™¨äºº ChatGPT å‘é€æ¶ˆæ¯å³è¡¨ç¤ºï¼Œä½ åŒæ„æˆ‘ä»¬çš„æ¡æ¬¾å¹¶å·²é˜…è¯»æˆ‘ä»¬çš„éšç§æ”¿ç­–ã€‚
        </div>
    </div>

    <script>
        (function() {
            // ----- æ ¸å¿ƒå…ƒç´  -----
            const chatContainer = document.getElementById('chatContainer');
            const inputBox = document.getElementById('inputBox');
            const sendButton = document.getElementById('sendButton');
            const webSearchToggle = document.getElementById('webSearchToggle');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const newChatBtn = document.getElementById('newChatBtn');
            const selectSelected = document.getElementById('selectSelected');
            const selectItems = document.getElementById('selectItems');
            const customSelect = document.getElementById('customSelect');
            const enhancementsContainer = document.getElementById('enhancementsContainer');

            // ----- çŠ¶æ€ -----
            let isThinking = false;
            let webSearchEnabled = false;
            let conversationContext = "";
            let hasUserSentMessage = false;
            
            // å½“å‰æ¿€æ´»çš„å¢å¼ºæ¨¡å‹ID (å¦‚ 'openrouter:openai/o3-deep-research')ï¼Œnull è¡¨ç¤ºä½¿ç”¨åŸºç¡€æ¨¡å‹
            let currentEnhancementId = null;

            // ----- æ¨¡å‹åç§°æ˜ å°„ (åŒ…å«åŸºç¡€æ¨¡å‹ + æ‰€æœ‰å¢å¼ºå˜ä½“) -----
            const modelNames = {
                // GPT-5.2 ç³»åˆ—
                'gpt-5.2-chat': 'GPT-5.2 Instant',
                'gpt-5.2': 'GPT-5.2 Thinking',
                'openrouter:openai/gpt-5.2-pro': 'GPT-5.2 Pro',
                // oç³»åˆ—åŸºç¡€
                'o1': 'OpenAI o1',
                'o3': 'OpenAI o3',
                'o3-mini': 'OpenAI o3-mini',
                'o4-mini': 'OpenAI o4-mini',
                // o3 å¢å¼º
                'openrouter:openai/o3-deep-research': 'OpenAI o3 Deep Research',
                'openrouter:openai/o3-pro': 'OpenAI o3 Pro',
                // o3-mini å¢å¼º
                'openrouter:openai/o3-mini-high': 'OpenAI o3-mini-high',
                // o4-mini å¢å¼º
                'openrouter:openai/o4-mini-high': 'OpenAI o4-mini-high',
                'openrouter:openai/o4-mini-deep-research': 'OpenAI o4-mini Deep Research',
                // Legacy
                'openrouter:openai/gpt-4': 'GPT-4',
                'openrouter:openai/gpt-4-turbo': 'GPT-4 Turbo',
                'openrouter:openai/gpt-3.5-turbo': 'GPT-3.5 Turbo'
            };

            // ----- å¢å¼ºæ˜ å°„: åŸºç¡€æ¨¡å‹ -> æ”¯æŒçš„å¢å¼ºåˆ—è¡¨ -----
            const enhancementMap = {
                'o3': [
                    { name: 'Deep Research', modelId: 'openrouter:openai/o3-deep-research' },
                    { name: 'Pro', modelId: 'openrouter:openai/o3-pro' }
                ],
                'o3-mini': [
                    { name: 'High', modelId: 'openrouter:openai/o3-mini-high' }
                ],
                'o4-mini': [
                    { name: 'High', modelId: 'openrouter:openai/o4-mini-high' },
                    { name: 'Deep Research', modelId: 'openrouter:openai/o4-mini-deep-research' }
                ]
            };

            // ----- åˆå§‹åŒ–æ¬¢è¿è¯­ -----
            const welcomeMessages = [
                "æœ‰ä»€ä¹ˆå¯ä»¥å¸®å¿™çš„ï¼Ÿ",
                "æˆ‘ä»¬å…ˆä»å“ªé‡Œå¼€å§‹å‘¢ï¼Ÿ",
                "å‡†å¤‡å¥½äº†ï¼Œéšæ—¶å¼€å§‹",
                "ä»Šå¤©æœ‰ä»€ä¹ˆè®¡åˆ’ï¼Ÿ",
                "æ‚¨ä»Šå¤©åœ¨æƒ³ä»€ä¹ˆï¼Ÿ",
                "ä½ åœ¨å¿™ä»€ä¹ˆï¼Ÿ"
            ];
            welcomeMessage.textContent = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            marked.setOptions({ breaks: true, gfm: true });

            // ----- æ„å»ºæç®€ä¸‹æ‹‰æ¡† (ç§»é™¤äº†æ‰€æœ‰é‡å¤å˜ä½“) -----
            function initCustomSelect() {
                const modelGroups = {
                    'GPT-5.2 ç³»åˆ—': ['gpt-5.2-chat', 'gpt-5.2', 'openrouter:openai/gpt-5.2-pro'],
                    'o ç³»åˆ—': ['o1', 'o3', 'o3-mini', 'o4-mini'],   // åªä¿ç•™åŸºç¡€å‹å·
                    'Legacy (ä¸èƒ½è”ç½‘)': ['openrouter:openai/gpt-4', 'openrouter:openai/gpt-4-turbo', 'openrouter:openai/gpt-3.5-turbo']
                };

                selectItems.innerHTML = '';
                for (const [groupName, models] of Object.entries(modelGroups)) {
                    // åˆ†ç»„æ ‡é¢˜
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'select-item select-group';
                    groupDiv.textContent = groupName;
                    groupDiv.style.cssText = 'color: #666; font-size: 12px; padding: 8px 12px 4px; cursor: default; background: #f8f9fa; border-bottom: 1px solid #eee;';
                    selectItems.appendChild(groupDiv);

                    // æ¨¡å‹é€‰é¡¹
                    models.forEach(model => {
                        const item = document.createElement('div');
                        item.className = 'select-item';
                        item.dataset.value = model;
                        item.textContent = modelNames[model] || model;
                        // æ ‡è®° Legacy ç»„ (ç”¨äºç¦ç”¨è”ç½‘)
                        if (groupName.includes('Legacy')) item.dataset.legacy = 'true';
                        selectItems.appendChild(item);
                    });
                }

                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªæ¨¡å‹ (GPT-5.2 Instant)
                const firstModel = document.querySelector('.select-item:not(.select-group)');
                if (firstModel) {
                    firstModel.classList.add('selected');
                    selectSelected.textContent = firstModel.textContent;
                    // æ ¹æ®é»˜è®¤æ¨¡å‹è®¾ç½®è”ç½‘æŒ‰é’®çŠ¶æ€
                    const isLegacy = firstModel.dataset.legacy === 'true';
                    webSearchToggle.disabled = isLegacy;
                    webSearchToggle.style.opacity = isLegacy ? '0.5' : '1';
                    webSearchToggle.style.cursor = isLegacy ? 'not-allowed' : 'pointer';
                    
                    // åˆå§‹åŒ–å¢å¼ºåŒºåŸŸ (åŸºäºé»˜è®¤æ¨¡å‹)
                    updateEnhancementsForModel(firstModel.dataset.value);
                }

                // ä¸‹æ‹‰ç‚¹å‡»äº‹ä»¶
                selectSelected.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectItems.classList.toggle('active');
                });

                // é€‰é¡¹ç‚¹å‡»
                document.querySelectorAll('.select-item:not(.select-group)').forEach(item => {
                    item.addEventListener('click', function() {
                        selectSelected.textContent = this.textContent;
                        document.querySelectorAll('.select-item:not(.select-group)').forEach(el => {
                            el.classList.remove('selected');
                        });
                        this.classList.add('selected');

                        // æ›´æ–°è”ç½‘æŒ‰é’®
                        const isLegacy = this.dataset.legacy === 'true';
                        webSearchToggle.disabled = isLegacy;
                        webSearchToggle.style.opacity = isLegacy ? '0.5' : '1';
                        webSearchToggle.style.cursor = isLegacy ? 'not-allowed' : 'pointer';
                        if (isLegacy) webSearchToggle.classList.remove('active');

                        // åˆ‡æ¢æ¨¡å‹ â†’ é‡ç½®å¢å¼ºæ¿€æ´»çŠ¶æ€ï¼Œæ›´æ–°å¢å¼ºæŒ‰é’®
                        currentEnhancementId = null;
                        updateEnhancementsForModel(this.dataset.value);

                        selectItems.classList.remove('active');
                    });
                });

                // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰
                document.addEventListener('click', function(e) {
                    if (!customSelect.contains(e.target)) {
                        selectItems.classList.remove('active');
                    }
                });
            }

            // ----- æ ¹æ®å½“å‰åŸºç¡€æ¨¡å‹ æ˜¾ç¤º/éšè— å¹¶ç”Ÿæˆå¢å¼ºæŒ‰é’® -----
            function updateEnhancementsForModel(baseModelValue) {
                const enhancements = enhancementMap[baseModelValue];
                if (!enhancements || enhancements.length === 0) {
                    enhancementsContainer.style.display = 'none';
                    enhancementsContainer.innerHTML = '';
                    currentEnhancementId = null;  // æ²¡æœ‰å¢å¼ºæ—¶æ¸…ç©º
                    return;
                }

                // æ˜¾ç¤ºå®¹å™¨ï¼Œå¹¶é‡æ–°ç”ŸæˆæŒ‰é’®
                enhancementsContainer.style.display = 'flex';
                enhancementsContainer.innerHTML = '';

                enhancements.forEach(enh => {
                    const btn = document.createElement('button');
                    btn.className = 'enhancement-btn';
                    btn.textContent = enh.name;
                    btn.dataset.enhancementId = enh.modelId;
                    
                    // å¦‚æœå½“å‰æ¿€æ´»çš„IDåŒ¹é…ï¼Œè®¾ä¸ºactive
                    if (currentEnhancementId === enh.modelId) {
                        btn.classList.add('active');
                    }

                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const clickedId = btn.dataset.enhancementId;

                        // å¦‚æœç‚¹å‡»çš„æŒ‰é’®å·²ç»æ˜¯æ¿€æ´»çŠ¶æ€ â†’ å…³é—­å¢å¼º (è®¾ä¸ºnull)
                        if (btn.classList.contains('active')) {
                            currentEnhancementId = null;
                        } else {
                            // å¦åˆ™æ¿€æ´»å½“å‰æŒ‰é’®ï¼Œå¹¶ç¡®ä¿åŒç»„å…¶ä»–æŒ‰é’®å–æ¶ˆæ¿€æ´» (äº’æ–¥)
                            currentEnhancementId = clickedId;
                        }

                        // æ›´æ–°å®¹å™¨å†…æ‰€æœ‰æŒ‰é’®çš„activeçŠ¶æ€
                        Array.from(enhancementsContainer.children).forEach(b => {
                            const bid = b.dataset.enhancementId;
                            if (bid === currentEnhancementId) {
                                b.classList.add('active');
                            } else {
                                b.classList.remove('active');
                            }
                        });
                    });

                    enhancementsContainer.appendChild(btn);
                });
            }

            // ----- è·å–å½“å‰çœŸæ­£ä½¿ç”¨çš„æ¨¡å‹ID (åŸºç¡€ + å¢å¼º) -----
            function getEffectiveModelId() {
                const baseItem = document.querySelector('.select-item.selected');
                if (!baseItem) return 'gpt-5.2-chat'; // fallback
                const baseModel = baseItem.dataset.value;
                // å¦‚æœæœ‰æ¿€æ´»çš„å¢å¼ºï¼Œä¸”å±äºå½“å‰åŸºç¡€æ¨¡å‹ (é¿å…åˆ‡æ¢åæ®‹ç•™)
                if (currentEnhancementId) {
                    // ç®€å•æ£€æŸ¥è¯¥å¢å¼ºæ˜¯å¦å±äºå½“å‰åŸºç¡€æ¨¡å‹ (é˜²æ­¢æ‰‹åŠ¨åˆ‡æ¢æ¨¡å‹åå¢å¼ºæŒ‰é’®æœªåŠæ—¶æ¸…é™¤ï¼Œä½†updateå·²å¤„ç†)
                    const allowed = enhancementMap[baseModel]?.some(e => e.modelId === currentEnhancementId);
                    if (allowed) return currentEnhancementId;
                }
                return baseModel;
            }

            // ----- è·å–æ¨¡å‹æ˜¾ç¤ºåç§° (ç”¨äºæ¶ˆæ¯label) -----
            function getModelDisplayName(modelId) {
                return modelNames[modelId] || modelId;
            }

            // ----- æ·»åŠ æ¶ˆæ¯ (å°å¹…æ”¹é€ ï¼šæ”¯æŒæœ€ç»ˆæ¨¡å‹åç§°) -----
            function addMessage(content, isUser = false, isStreaming = false, finalModelName = null) {
                if (isUser && !hasUserSentMessage) {
                    welcomeMessage.style.display = 'none';
                    hasUserSentMessage = true;
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;

                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';

                if (isUser) {
                    messageContent.innerHTML = content.replace(/\n/g, '<br>');
                } else if (isStreaming) {
                    messageContent.innerHTML = '<span class="typing"></span>æ€è€ƒä¸­...';
                    messageDiv.id = 'streamingMessage';
                } else {
                    // åªæœ‰æœ€ç»ˆæ¶ˆæ¯æ‰æ·»åŠ æ¨¡å‹æ ‡ç­¾
                    const modelLabel = document.createElement('span');
                    modelLabel.className = 'model-label';
                    modelLabel.textContent = `Generated by ${finalModelName || selectSelected.textContent}`;
                    messageDiv.appendChild(modelLabel);
                    messageContent.innerHTML = marked.parse(content);
                }

                messageDiv.appendChild(messageContent);
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                return { messageDiv, messageContent };
            }

            // ----- å‘é€æ¶ˆæ¯ -----
            async function sendMessage() {
                if (isThinking) return;

                const userInput = inputBox.value.trim();
                if (!userInput) return;

                inputBox.value = '';
                addMessage(userInput, true);

                isThinking = true;
                sendButton.disabled = true;
                inputBox.disabled = true;

                const { messageDiv, messageContent } = addMessage('', false, true);

                // ç¡®å®šæœ€ç»ˆä½¿ç”¨çš„æ¨¡å‹IDå’Œæ˜¾ç¤ºåç§°
                const effectiveModelId = getEffectiveModelId();
                const modelDisplayName = getModelDisplayName(effectiveModelId);

                try {
                    const fullPrompt = conversationContext + "ç”¨æˆ·: " + userInput + "\nAI: ";
                    const options = { stream: true, model: effectiveModelId };
                    if (webSearchEnabled && !webSearchToggle.disabled) {
                        options.tools = [{ type: "web_search" }];
                    }

                    const response = await puter.ai.chat(fullPrompt, options);
                    let fullResponse = '';
                    messageContent.innerHTML = '';

                    for await (const part of response) {
                        if (part?.text) {
                            fullResponse += part.text;
                            messageContent.innerHTML = marked.parse(fullResponse);
                        }
                    }

                    // æ›´æ–°ä¸Šä¸‹æ–‡
                    conversationContext += "ç”¨æˆ·: " + userInput + "\nAI: " + fullResponse + "\n";
                    const lines = conversationContext.split('\n');
                    if (lines.length > 20) conversationContext = lines.slice(-20).join('\n');

                    // ç§»é™¤ä¸´æ—¶çš„â€œæ€è€ƒä¸­â€ï¼Œæ›¿æ¢ä¸ºæ­£å¼å†…å®¹ï¼Œå¹¶æ’å…¥æ­£ç¡®çš„æ¨¡å‹æ ‡ç­¾
                    messageDiv.id = '';
                    // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§æ ‡ç­¾ï¼ˆæµå¼æ—¶æ²¡æœ‰æ ‡ç­¾ï¼Œä½†ä»¥é˜²ä¸‡ä¸€ï¼‰
                    const oldLabel = messageDiv.querySelector('.model-label');
                    if (oldLabel) oldLabel.remove();
                    
                    const modelLabel = document.createElement('span');
                    modelLabel.className = 'model-label';
                    modelLabel.textContent = `Generated by ${modelDisplayName}`;
                    messageDiv.insertBefore(modelLabel, messageDiv.firstChild);

                } catch (error) {
                    messageContent.innerHTML = `é”™è¯¯: ${error.message}`;
                } finally {
                    isThinking = false;
                    sendButton.disabled = false;
                    inputBox.disabled = false;
                    inputBox.focus();
                }
            }

            // ----- äº‹ä»¶ç»‘å®š -----
            inputBox.addEventListener('input', () => {
                inputBox.style.height = 'auto';
                inputBox.style.height = Math.min(inputBox.scrollHeight, 132) + 'px';
            });

            inputBox.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey && !isThinking) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            sendButton.addEventListener('click', sendMessage);

            webSearchToggle.addEventListener('click', () => {
                if (webSearchToggle.disabled) return;
                webSearchEnabled = !webSearchEnabled;
                webSearchToggle.classList.toggle('active', webSearchEnabled);
            });

            newChatBtn.addEventListener('click', () => {
                if (chatContainer.children.length > 1 && !confirm('å¼€å§‹æ–°å¯¹è¯å°†æ¸…é™¤å½“å‰å¯¹è¯ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) return;
                window.location.reload();
            });

            initCustomSelect();
            inputBox.focus();

        })();
    </script>
</body>
</html>
