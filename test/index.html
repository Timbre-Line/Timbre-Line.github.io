<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GPT-5.2 Pro 参数测试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test { padding: 15px; margin: 10px 0; border-left: 5px solid #ccc; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>GPT-5.2 Pro 参数测试</h1>
    
    <div>
        <button onclick="testGPT52Pro()">测试 GPT-5.2 Pro</button>
        <button onclick="testWithDifferentParams()">测试不同参数</button>
    </div>
    
    <div id="results"></div>
    
    <script src="https://js.puter.com/v2/"></script>
    <script>
        const resultsDiv = document.getElementById('results');
        
        function createTestResult(title, success, data) {
            const div = document.createElement('div');
            div.className = success ? 'test success' : 'test error';
            div.innerHTML = `<strong>${title}</strong>`;
            
            if (success) {
                div.innerHTML += `<p>✅ 成功</p>`;
                if (typeof data === 'string') {
                    div.innerHTML += `<p>${data}</p>`;
                } else if (data?.message?.content) {
                    div.innerHTML += `<p>${data.message.content}</p>`;
                }
            } else {
                div.innerHTML += `<p>❌ 失败</p>`;
                if (data?.message) {
                    div.innerHTML += `<pre>${data.message}</pre>`;
                }
            }
            
            resultsDiv.appendChild(div);
            return div;
        }
        
        async function testGPT52Pro() {
            const model = "openrouter:openai/gpt-5.2-pro";
            
            // 尝试1: 标准参数（可能失败）
            try {
                const response = await puter.ai.chat("AI是什么？", {
                    model: model,
                    max_tokens: 50
                });
                createTestResult(`${model} (max_tokens: 50)`, true, response);
            } catch (error) {
                createTestResult(`${model} (max_tokens: 50)`, false, error);
            }
            
            // 尝试2: 增加max_tokens
            try {
                const response = await puter.ai.chat("AI是什么？", {
                    model: model,
                    max_tokens: 100
                });
                createTestResult(`${model} (max_tokens: 100)`, true, response);
            } catch (error) {
                createTestResult(`${model} (max_tokens: 100)`, false, error);
            }
        }
        
        async function testWithDifferentParams() {
            const model = "openrouter:openai/gpt-5.2-pro";
            const tests = [
                { max_tokens: 16, temp: 0.7, name: "最小tokens (16)" },
                { max_tokens: 32, temp: 0.7, name: "32 tokens" },
                { max_tokens: 64, temp: 0.7, name: "64 tokens" },
                { max_tokens: 128, temp: 0.7, name: "128 tokens" },
                { max_tokens: 50, temp: 0.3, name: "低温 (0.3)" },
                { max_tokens: 50, temp: 0.9, name: "高温 (0.9)" }
            ];
            
            for (const test of tests) {
                try {
                    const response = await puter.ai.chat("AI是什么？用一句话回答。", {
                        model: model,
                        max_tokens: test.max_tokens,
                        temperature: test.temp
                    });
                    createTestResult(`${model} - ${test.name}`, true, response);
                } catch (error) {
                    createTestResult(`${model} - ${test.name}`, false, error);
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        // 对比测试其他模型
        async function compareModels() {
            const models = [
                "openrouter:openai/gpt-5.2",
                "openrouter:openai/gpt-5.2-chat",
                "openrouter:openai/gpt-5.2-pro"
            ];
            
            for (const model of models) {
                try {
                    const response = await puter.ai.chat("测试", {
                        model: model,
                        max_tokens: 10
                    });
                    createTestResult(`${model} (max_tokens: 10)`, true, response);
                } catch (error) {
                    createTestResult(`${model} (max_tokens: 10)`, false, error);
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        // 页面加载时运行
        window.onload = function() {
            setTimeout(() => {
                testGPT52Pro();
            }, 500);
        };
    </script>
    
    <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 5px;">
        <h3>问题分析</h3>
        <p><strong>错误信息：</strong></p>
        <pre>Invalid 'max_output_tokens': integer below minimum value. Expected a value >= 16, but got 5 instead.</pre>
        <p><strong>问题：</strong>GPT-5.2 Pro 要求最少输出16个token</p>
        <p><strong>解决方案：</strong>使用 <code>max_tokens: 16</code> 或更多</p>
        <p><strong>有趣发现：</strong></p>
        <ul>
            <li>GPT-5.2 和 GPT-5.2-chat 可能没有这个限制</li>
            <li>GPT-5.2-pro 可能有更高的最低输出要求</li>
            <li>这可能是因为 pro 版本针对更长、更复杂的输出进行了优化</li>
        </ul>
    </div>
</body>
</html>
