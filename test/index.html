<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>é¡ºåºæµ‹è¯• OpenRouter oç³»åˆ—æ¨¡å‹</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .model-result { padding: 10px; margin: 5px 0; border-left: 5px solid #ccc; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .timeout { border-left-color: #ff6b00; background: #ffe5d6; }
        .testing { border-left-color: #ffc107; background: #fff3cd; }
        button { margin: 10px 5px; padding: 10px 20px; }
        #progress { margin: 20px 0; }
        kbd { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 3px; padding: 2px 5px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>é¡ºåºæµ‹è¯• OpenRouter OpenAI oç³»åˆ—æ¨¡å‹</h1>
    <p>æµ‹è¯•æ—¶é—´: <span id="timestamp"></span></p>
    
    <div id="progress">
        <div id="current-test">å‡†å¤‡å¼€å§‹æµ‹è¯•...</div>
        <div id="progress-bar" style="height: 5px; background: #eee; margin: 10px 0;">
            <div id="progress-fill" style="height: 100%; width: 0%; background: #007bff; transition: width 0.5s;"></div>
        </div>
    </div>
    
    <button onclick="startSequentialTest()">å¼€å§‹é¡ºåºæµ‹è¯•</button>
    <button onclick="stopTest()">åœæ­¢æµ‹è¯•</button>
    
    <div id="results">
        <h3>æµ‹è¯•ç»“æœ:</h3>
        <div id="test-output"></div>
    </div>
    
    <script src="https://js.puter.com/v2/"></script>
    <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleString();
        
        // OpenRouter ä¸Šçš„æ‰€æœ‰ OpenAI o ç³»åˆ—æ¨¡å‹
        const openRouterOModels = [
            "openrouter:openai/o1",
            "openrouter:openai/o1-mini",
            "openrouter:openai/o1-mini-2024-09-12",
            "openrouter:openai/o1-pro",
            "openrouter:openai/o3",
            "openrouter:openai/o3-mini",
            "openrouter:openai/o3-mini-high",
            "openrouter:openai/o3-pro",
            "openrouter:openai/o3-deep-research",
            "openrouter:openai/o4-mini",
            "openrouter:openai/o4-mini-high",
            "openrouter:openai/o4-mini-deep-research"
        ];
        
        const outputDiv = document.getElementById('test-output');
        const currentTestDiv = document.getElementById('current-test');
        const progressFill = document.getElementById('progress-fill');
        
        let testIndex = 0;
        let isTesting = false;
        let timeoutId = null;
        const TIMEOUT_MS = 60000; // 60ç§’è¶…æ—¶
        
        // åˆ›å»ºæµ‹è¯•ç»“æœæ¡ç›®
        function createTestResult(modelName) {
            const div = document.createElement('div');
            div.className = 'model-result testing';
            div.id = `result-${modelName.replace(/[:\/.-]/g, '_')}`;
            div.innerHTML = `
                <strong>${modelName}</strong>
                <span class="status">æµ‹è¯•ä¸­...</span>
                <div class="details" style="font-size: 12px; margin-top: 5px; color: #666;"></div>
            `;
            return div;
        }
        
        // æ›´æ–°æµ‹è¯•ç»“æœ - ä¿®å¤å¤„ç†å“åº”æ•°æ®çš„é—®é¢˜
        function updateTestResult(modelName, type, data, duration = null) {
            const resultId = `result-${modelName.replace(/[:\/.-]/g, '_')}`;
            const div = document.getElementById(resultId);
            if (!div) return;
            
            const statusSpan = div.querySelector('.status');
            const detailsDiv = div.querySelector('.details');
            
            if (type === 'success') {
                div.className = 'model-result success';
                statusSpan.innerHTML = `âœ… æˆåŠŸ (${duration}ms)`;
                
                // å®‰å…¨åœ°å¤„ç†å“åº”æ•°æ®
                let responseText = '';
                if (typeof data === 'string') {
                    responseText = data;
                } else if (data?.message?.content) {
                    responseText = data.message.content;
                } else if (data?.content) {
                    responseText = data.content;
                } else {
                    responseText = JSON.stringify(data).substring(0, 200);
                }
                
                detailsDiv.innerHTML = `<em>å“åº”:</em> ${responseText.substring(0, 150)}${responseText.length > 150 ? '...' : ''}`;
                
            } else if (type === 'error') {
                div.className = 'model-result error';
                statusSpan.innerHTML = 'âŒ å¤±è´¥';
                
                let errorMsg = '';
                if (typeof data === 'string') {
                    errorMsg = data;
                } else if (data?.error?.message) {
                    errorMsg = data.error.message;
                } else if (data?.message) {
                    errorMsg = data.message;
                } else {
                    errorMsg = JSON.stringify(data).substring(0, 200);
                }
                
                detailsDiv.innerHTML = `<em>é”™è¯¯:</em> ${errorMsg.substring(0, 200)}${errorMsg.length > 200 ? '...' : ''}`;
                
            } else if (type === 'timeout') {
                div.className = 'model-result timeout';
                statusSpan.innerHTML = 'â° è¶…æ—¶';
                detailsDiv.innerHTML = `<em>è¶…æ—¶:</em> è¶…è¿‡${TIMEOUT_MS/1000}ç§’æ— å“åº”`;
            }
        }
        
        // æµ‹è¯•å•ä¸ªæ¨¡å‹ï¼ˆå¸¦è¶…æ—¶æ§åˆ¶ï¼‰- ç®€åŒ–ç‰ˆæœ¬
        async function testModelWithTimeout(modelName) {
            return new Promise(async (resolve) => {
                let timeout = false;
                
                // è®¾ç½®è¶…æ—¶
                timeoutId = setTimeout(() => {
                    timeout = true;
                    updateTestResult(modelName, 'timeout', 'è¶…æ—¶');
                    resolve({ model: modelName, success: false, error: 'timeout' });
                }, TIMEOUT_MS);
                
                try {
                    console.log(`å¼€å§‹æµ‹è¯•: ${modelName}`);
                    const startTime = Date.now();
                    
                    // ä½¿ç”¨ç®€å•çš„æµ‹è¯•é—®é¢˜
                    const response = await puter.ai.chat("2+2=?", {
                        model: modelName,
                        max_tokens: 10,
                        temperature: 0
                    });
                    
                    const endTime = Date.now();
                    
                    if (!timeout) {
                        clearTimeout(timeoutId);
                        
                        // è°ƒè¯•ï¼šæŸ¥çœ‹å“åº”ç»“æ„
                        console.log(`${modelName} å“åº”:`, response);
                        console.log(`å“åº”ç±»å‹:`, typeof response);
                        if (response && typeof response === 'object') {
                            console.log(`å“åº”é”®:`, Object.keys(response));
                        }
                        
                        updateTestResult(modelName, 'success', response, endTime - startTime);
                        resolve({ 
                            model: modelName, 
                            success: true, 
                            response: response,
                            duration: endTime - startTime
                        });
                    }
                } catch (error) {
                    if (!timeout) {
                        clearTimeout(timeoutId);
                        console.error(`${modelName} é”™è¯¯:`, error);
                        updateTestResult(modelName, 'error', error);
                        resolve({ 
                            model: modelName, 
                            success: false, 
                            error: error
                        });
                    }
                }
            });
        }
        
        // é¡ºåºæµ‹è¯•æ‰€æœ‰æ¨¡å‹
        async function startSequentialTest() {
            if (isTesting) return;
            isTesting = true;
            testIndex = 0;
            outputDiv.innerHTML = '';
            
            for (let i = 0; i < openRouterOModels.length; i++) {
                if (!isTesting) break; // å¦‚æœç”¨æˆ·åœæ­¢äº†æµ‹è¯•
                
                const model = openRouterOModels[i];
                testIndex = i;
                
                // æ›´æ–°è¿›åº¦
                const progress = ((i + 1) / openRouterOModels.length) * 100;
                progressFill.style.width = `${progress}%`;
                currentTestDiv.innerHTML = `æ­£åœ¨æµ‹è¯•: ${model} (${i + 1}/${openRouterOModels.length})`;
                
                // åˆ›å»ºç»“æœæ¡ç›®
                const resultDiv = createTestResult(model);
                outputDiv.appendChild(resultDiv);
                
                // æ»šåŠ¨åˆ°æœ€æ–°ç»“æœ
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // æµ‹è¯•å½“å‰æ¨¡å‹
                await testModelWithTimeout(model);
                
                // ç­‰å¾…1ç§’å†æµ‹è¯•ä¸‹ä¸€ä¸ªï¼Œé¿å…é€Ÿç‡é™åˆ¶
                if (isTesting && i < openRouterOModels.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            // æµ‹è¯•å®Œæˆ
            if (isTesting) {
                currentTestDiv.innerHTML = 'æµ‹è¯•å®Œæˆï¼';
                progressFill.style.width = '100%';
                displaySummary();
                isTesting = false;
            }
        }
        
        // åœæ­¢æµ‹è¯•
        function stopTest() {
            isTesting = false;
            if (timeoutId) {
                clearTimeout(timeoutId);
            }
            currentTestDiv.innerHTML = 'æµ‹è¯•å·²åœæ­¢';
        }
        
        // æ˜¾ç¤ºæ€»ç»“
        function displaySummary() {
            const successCount = document.querySelectorAll('.model-result.success').length;
            const errorCount = document.querySelectorAll('.model-result.error').length;
            const timeoutCount = document.querySelectorAll('.model-result.timeout').length;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'model-result';
            summaryDiv.style.background = '#e7f3ff';
            summaryDiv.style.borderLeftColor = '#007bff';
            
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š æµ‹è¯•æ€»ç»“</h3>
                <p><strong>æ€»æµ‹è¯•æ¨¡å‹æ•°:</strong> ${openRouterOModels.length}</p>
                <p><strong>âœ… æˆåŠŸ:</strong> ${successCount} ä¸ª</p>
                <p><strong>âŒ å¤±è´¥:</strong> ${errorCount} ä¸ª</p>
                <p><strong>â° è¶…æ—¶:</strong> ${timeoutCount} ä¸ª</p>
                
                <h4>å¯ç”¨æ¨¡å‹:</h4>
                <div id="available-models" style="margin-bottom: 10px;"></div>
                
                <h4>ä¸å¯ç”¨æ¨¡å‹:</h4>
                <div id="unavailable-models"></div>
            `;
            
            outputDiv.appendChild(summaryDiv);
            
            // æ”¶é›†å¯ç”¨å’Œä¸å¯ç”¨æ¨¡å‹
            const availableModels = [];
            const unavailableModels = [];
            
            openRouterOModels.forEach(model => {
                const resultDiv = document.getElementById(`result-${model.replace(/[:\/.-]/g, '_')}`);
                if (resultDiv && resultDiv.classList.contains('success')) {
                    availableModels.push(model);
                } else {
                    unavailableModels.push(model);
                }
            });
            
            document.getElementById('available-models').innerHTML = 
                availableModels.map(m => `<code>${m}</code>`).join('<br>') || 'æ— ';
            
            document.getElementById('unavailable-models').innerHTML = 
                unavailableModels.map(m => `<code>${m}</code>`).join('<br>') || 'æ— ';
            
            // ä¿å­˜ç»“æœåˆ°æ§åˆ¶å°
            console.log('=== æµ‹è¯•å®Œæˆ ===');
            console.log(`æˆåŠŸ: ${successCount}, å¤±è´¥: ${errorCount}, è¶…æ—¶: ${timeoutCount}`);
            console.log('å¯ç”¨æ¨¡å‹:', availableModels);
            console.log('ä¸å¯ç”¨æ¨¡å‹:', unavailableModels);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å¼€å§‹æµ‹è¯•
        window.onload = function() {
            // å…ˆå¿«é€Ÿæµ‹è¯•ä¸€ä¸‹åŸºç¡€åŠŸèƒ½
            setTimeout(() => {
                console.log("å¼€å§‹è‡ªåŠ¨æµ‹è¯•...");
                startSequentialTest();
            }, 1000);
        };
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.key === 's' || e.key === 'S') {
                e.preventDefault();
                if (!isTesting) {
                    startSequentialTest();
                } else {
                    stopTest();
                }
            }
        });
        
        // æ·»åŠ ä¸€ä¸ªç®€å•çš„å¸®åŠ©ä¿¡æ¯
        console.log(`
=== OpenRouter oç³»åˆ—æ¨¡å‹æµ‹è¯• ===
1. ç‚¹å‡»"å¼€å§‹é¡ºåºæµ‹è¯•"æŒ‰é’®æˆ–æŒ‰Sé”®å¼€å§‹
2. æ¯ä¸ªæ¨¡å‹æœ€å¤šç­‰å¾…60ç§’
3. æˆåŠŸ: æ˜¾ç¤ºå“åº”æ—¶é—´
4. å¤±è´¥: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
5. è¶…æ—¶: 60ç§’æ— å“åº”
        `);
    </script>
    
    <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
        <p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong></p>
        <ul>
            <li>ç‚¹å‡» <kbd>å¼€å§‹é¡ºåºæµ‹è¯•</kbd> æˆ–æŒ‰ <kbd>S</kbd> é”®å¼€å§‹æµ‹è¯•</li>
            <li>ç‚¹å‡» <kbd>åœæ­¢æµ‹è¯•</kbd> æˆ–å†æŒ‰ <kbd>S</kbd> é”®åœæ­¢æµ‹è¯•</li>
            <li>æ¯ä¸ªæ¨¡å‹æµ‹è¯•æœ€å¤šç­‰å¾…60ç§’</li>
            <li>âœ… æˆåŠŸï¼šæ˜¾ç¤ºå“åº”æ—¶é—´å’Œéƒ¨åˆ†å“åº”å†…å®¹</li>
            <li>âŒ å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</li>
            <li>â° è¶…æ—¶ï¼š60ç§’æ— å“åº”</li>
        </ul>
        <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
        <ul>
            <li><code>openrouter:openai/o1</code> - åº”è¯¥æˆåŠŸ âœ…</li>
            <li><code>openrouter:openai/o1-mini</code> - åº”è¯¥å¤±è´¥ âŒï¼ˆä¸å­˜åœ¨ï¼‰</li>
            <li><code>openrouter:openai/o3-mini</code> - åº”è¯¥æˆåŠŸ âœ…</li>
            <li><code>openrouter:openai/o4-mini</code> - å¯èƒ½æˆåŠŸä½†è¾ƒæ…¢ âœ…</li>
        </ul>
    </div>
</body>
</html>
